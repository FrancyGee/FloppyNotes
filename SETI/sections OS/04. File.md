---
title: 04. File
date: 2023-01-12
tags: SETI-OS, file, permission
difficulty: üü¢
---

<h1  style="text-align: center;">  04. File üìÑ </h1> 

Su Linux ogni cosa √® un file, ogni file ha:
- un **file descriptor**
- dei **permessi (read, write, execute)**
- un **owner**

Per ottenere informazioni riguardanti il file utilizziamo la syscall:
```c
int stat(const char *pathname, struct stat *statbuf);

int lstat(const char *pathname struct stat *statbuf);

int fstat(int fd, struct stat *statbuf);
```
Consultare il **man** per maggiori informazioni.

# Permessi

Ogni file ha tre tipi di permessi:
- **Read (r)**
- **Write (w)**
- **Execute (x)**

Questi tre permessi possono essere rappresentati con tre bit:

| **string** | **bit** | **valore numerico** | **valore singolo** |
| ---------- | ------- | ------------------- | ------------------ |
| ---        | 000     | 000                 | 0                  |
| --x        | 001     | 001                 | 1                  |
| -w-        | 010     | 020                 | 2                  |
| -wx        | 011     | 021                 | 3                  |
| r--        | 100     | 400                 | 4                  |
| r-x        | 101     | 401                 | 5                  |
| rw-        | 110     | 420                 | 6                  |
| rwx        | 111     | 421                 | 7                  |


Ogni permesso viene affidato a 3 diversi livelli:
- **User permission (u)**
	- I permessi per l'utente
- **Group permission (g)***
	- I permessi per il gruppo
- **Others permission (o)**
	- il permesso per tutti gli altri utenti


![[Pasted image 20230111155106.png|center|400]]

Un esempio:
```bash
drwxr-xr-x     - floppy 11 Jan 15:48  dir/
.rwxr-xr-x     0 floppy 11 Jan 15:48  executable
.rw-r--r--   792 floppy 11 Jan 11:35  main.py
```
Il `.` e la `d` a inizio riga indicano se sia un file o una directory

Per cambiare i permessi di un file utilizzare `chmod`.
Per cambiare il proprietario di un file utilizzare `chown`.


# Offset

Ogni file che viene aperto ha un **file offset/pointer** che indica la posizione nel quale scrivere.
Di default l'offset √® a 0 e si sposta con le syscall `read` e `write`.
Possiamo settare la posizione dell'offset con la syscall:
```c
off_t lseek(int fd, off_t offset, int whence);
```

Possiamo spostare l'offset oltre la fine del file (**EOF**), questo non andr√† a modificare  la dimensione del file, infatti le righe che avremo *"skippato"* saranno **riempiti da byte a 0**.

Il comando:
```bash
xxd -g 1 <nome-file>
```
Ci mostra il contenuto del file in esadecimale.


# Limiti

Ogni filesystem ha le sue limitazioni ad esempio:
- La lunghezza massima.
- Case-sensitive.
- Nomi non utilizzabili (riservati al sistema).

# Compilazione

Quando scriviamo un programma in C/C++ compiliamo  con dei compilatori come `gcc`,`clang` per creare dei file eseguibili.

>[!abstract] Compilazione
>La compilazione √® il processo di **traduzione** del codice sorgente **da linguaggio di programmazione a linguaggio macchina**.

Durante la compilazione intervengono:
- **Preprocessore**
- **Compilatore**
- **Assemblatore**
- **Linker**

![[Pasted image 20230112100119.png|center|700]]

## Preprocessore

Il preprocessore √® la **prima fase** della compilazione esso si occupa di:
- Elaborare le **Macro**
- Elaborare gli **Include**
- **Rimuovere i commenti**
- Gestione di costanti e variabili.

Una volta elaborato il tutto, riconosce i codici specifici degli `include` e delle `macro` e li sostituisce con i loro valori effettivi.

Al fine di ci√≤ crea (per quanto riguarda il C/C++) un file con estensione `.i` o `.ii` o `.s`.

## Compilatore

Successivamente il compilatore si occupa di **tradurre** il codice in **linguaggio macchina** per farlo passa per una fase intermedia dove traduce il tutto in **codice oggetto**, esso si occupa di:
- **analizzare** il codice sorgente
- **generare** il codice oggetto

Il file generato dalla compilazione ha estensione `.o`


## Assemblatore

L'assemblatore prende il **codice oggetto** generato dal compilatore e lo **traduce in codice macchina**. 

## Linker

Se tutte le fasi sono andate a buon fine, si arriva al Linker che ha come scopo quello di **unire tutti i file sorgente e header** (`.c/.cpp` e `.h`) e tutte le **librerie** incluse **in un unico file eseguibile**. 

Esistono due tipi di Linker:
- **Linker statico**
- **Linker dinamico**

Il **linking statico** √® il **processo di combinazione dei file di codice durante la compilazione**. In questo caso, **le librerie vengono incluse direttamente nel file eseguibile**, il che significa che **il file eseguibile risultante √® pi√π grande** ma non dipende da alcun file esterno per funzionare.

Il **linking dinamico** √® il **processo di combinazione dei file di codice in fase di esecuzione**. In questo caso, **le librerie non vengono incluse direttamente nel file eseguibile, ma vengono caricate solo quando il programma le richiede**. Ci√≤ significa che **il file eseguibile risultante √® pi√π piccolo** ma dipende da file esterni per funzionare.


## Eseguibile

Un eseguibile √® il prodotto finito della compilazione, esso contiene:
- **Codice Macchina**
- **Dati**
- **Metadati**
	- architettura della CPU
	- **entry-point** (l'entry-point di un eseguibile non √® il main ma da esso possiamo risalire all'indirizzo di memoria del `main`).
	- spazio da riservare a variabili globali
	- ...

In un eseguibile le sezioni vengono raggrupati in **segmenti** che vengono poi mappati in memoria grazie all'MMU, di questo ne abbiamo parlato meglio qui [[06. Virtualizzazione#Virtualizzazione della Memoria]].



# [[03.System Call|‚Üê Prev]] | [[05. Processi| Next ‚Üí]]






# Flashcards

Cosa si usa per cambiare i permessi del file:: `chmod`

Cosa si usa per cambiare il proprietario del file:: `chown`

Che tipi di permessi ha un file
?
- **Read (r)**
- **Write (w)**
- **Execute (x)**

Quanti bit servono per rappresentare i permessi di un file:: 3 bit.

Quali sono i tre livelli di permessi
?
- **User (u)**
- **Group User (g)**
- **Others (o)**

Quali permessi gestisce il livello **User**:: i permessi dell'utente

Quali permessi gestisce il livello **Group**:: i permessi del gruppo dell'utente

Quali permessi gestisce il livello **User**:: i permessi degli altri utenti

Cos'√® l'**offset pointer**:: Il puntatore alla posizione corrente del file.



Quali sono le fasi di compilazione
?
- **Preprocessore**
- **Compilatore**
- **Assemblatore**
- **Linker**

Di cosa si occupa il **Preprocessore**:: Di **elaborare** le macro e gi include, **gestire** le variabili, **eliminare** i commenti.

Di cosa si occupa il **Compilatore**:: Tradurre da linguaggio di programmazione a linguaggio macchina creando un codice oggetto.

Di cosa si occupa **l'Assemblatore**:: **Tradurre il codice oggetto** generato dal compilatore **in linguaggio macchina**.

Di cosa si occupa il **Linker**:: Di **riunire** tutti i source file, gli header e le librerie incluse **in un unico eseguibile**.

Quali sono i tipi di linking::
?
- **Statico**
- **Dinamico**

Cosa cambia tra linking statico e dinamico:: Nel linking statico **le librerie vengono aggiunte in fase di compilazione**, mentre nel linking dinamico **le librerie vengono aggiunte quando l'eseguibile lo richiede**.